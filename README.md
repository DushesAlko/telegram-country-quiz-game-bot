# Country Quiz Telegram Bot

Разработка интерактивного Telegram-бота «Country Quiz» на языке Java по дисциплине «Конструирование программного обеспечения». Открыть бота - @mistercountrybot

**Исполнители (гр. 5130904/30102):**
* **Аристов Егор Андреевич**
* **Иващенко Андрей Вадимович**

---

## 1. Определение проблемы
Классические методы изучения географии (атласы, таблицы) характеризуются низким уровнем интерактивности. Существующие мобильные приложения часто требуют отдельной установки, регистрации и занимают место в памяти устройства. Проект представляет собой серверное приложение, которое позволяет изучать географию (флаги, столицы, данные о странах) в формате викторины.

## 2. Выработка требований
Основные пользовательские сценарии работы с системой:
* **Сценарий «Быстрый старт»**: Пользователь нажимает /start, бот приветствует его и предлагает выбрать режим игры.
* **Сценарий «Игровой цикл»**: Бот присылает изображение флага и 4 кнопки с вариантами ответов. При нажатии пользователь получает мгновенный фидбек (верно/неверно) и следующий вопрос.
* **Сценарий «Статистика»**: Пользователь запрашивает команду /stats и получает отчет о количестве правильных ответов и общем месте в рейтинге.

**Нефункциональные требования**: Время отклика системы не должно превышать 1–2 секунд при стандартной нагрузке. Сервис должен быть доступен 24/7 и корректно обрабатывать одновременные запросы от большого количества пользователей.

## 3. Разработка архитектуры и детальное проектирование
Проект реализован на стеке Java 17 / Spring Boot 3. Для обеспечения персистентности данных используется PostgreSQL, а интеграция с внешними данными осуществляется через RestCountries API.

* **Оценка нагрузки**: Система рассчитана на 10 000 пользователей в сутки. При среднем количестве в 20 запросов на пользователя объем трафика составляет около 600 КБ/сутки.
* **Хранение данных**: Дисковое пространство для хранения данных (игровая статистика, профили) за 5 лет оценивается в 5–10 ГБ с учетом индексов и метаданных.
* **Масштабирование**: При росте нагрузки в 10 раз используется stateless-подход, позволяющий запускать N экземпляров приложения за балансировщиком (Round Robin). Для базы данных предусмотрена репликация с выделением Master-узла на запись и Slave-узлов на чтение.
  
**С4 model system diagram**
![С4 model system diagram](https://github.com/DushesAlko/telegram-country-quiz-game-bot/blob/master/img/c4_system.png)

**С4 model container diagram**
![C4 model container diagram](https://github.com/DushesAlko/telegram-country-quiz-game-bot/blob/master/img/c4_container.png)

**Database scheme**

![Image of database schema](https://github.com/DushesAlko/telegram-country-quiz-game-bot/blob/master/img/database_schema.png)


## 4. Кодирование и отладка
В процессе разработки каждый участник команды вносил изменения в кодовую базу, что подтверждается историей коммитов в репозитории. Система включает в себя бизнес-логику, обработчики команд и планировщик (Scheduler) для кэширования данных API. Использование Spring Boot позволило создать расширяемую архитектуру.

## 5. Unit тестирование
В проекте реализовано модульное тестирование (8 тестов в 3 файлах) с использованием JUnit 5 и Mockito.
* **Тестирование данных**: Проверка корректности получения игровой информации и работы резервного механизма при отсутствии данных от внешних источников.
* **Тестирование логики**: Проверка создания игровых сессий, обработки ответов пользователя, а также корректного начисления и списания очков.
* **Тестирование пользователей**: Проверка создания новых пользователей и обновления их игровой статистики (точность ответов, общее количество очков).

## 6. Интеграционное тестирование
Стабильность взаимодействия компонентов системы проверяется с помощью интеграционных тестов на базе технологии Testcontainers. Это позволяет в процессе тестирования автоматически развертывать реальную базу данных PostgreSQL в Docker-контейнере, обеспечивая полную идентичность тестовой и промышленной сред.

Тестовые сценарии имитируют полный цикл взаимодействия пользователя с ботом: от автоматического создания профиля при первом обращении до проведения серии игровых сессий. В ходе тестов проверяется корректность обработки правильных и неверных ответов, работа алгоритмов начисления баллов и автоматический пересчет агрегированной статистики (точность, общий счет). Кроме того, тестируется функциональность глобального рейтинга, что подтверждает надежность выполнения сложных SQL-запросов и стабильность связи приложения с базой данных под нагрузкой.


## 7. Сборка и запуск
Проект полностью контейнеризирован с использованием Docker. Для запуска приложения и тестов достаточно одной команды (требуется установленный Docker и bash-совместимая оболочка).

**Запуск приложения**:

```bash
docker-compose up --build
```

**Сборка и тесты**:

```bash
mvn clean install
```
---
Файл `report.pdf` - отчёт по проделанной работе.
